<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="EmployeeDAO">

    <!-- 직원 목록 조회 -->
    <select id="selectEmployeeList" parameterType="biz.lms.emp.vo.EmployeeVO" resultType="biz.lms.emp.vo.EmployeeVO">
        /* EmployeeDAO.selectEmployeeList */
        SELECT * FROM (
            SELECT ROW_NUMBER() OVER(ORDER BY REG_DATE DESC, EMP_NO) AS RN, TB.* FROM (
                SELECT
                    EMP_NO
                    ,EMP_NAME
                    ,EMAIL
                    ,PHONE
                    ,DEPT_CODE
                    ,DEPT_NAME
                    ,POSITION
                    ,HIRE_DATE
                    ,SALARY
                    ,STATUS
                    ,REG_USER
                    ,REG_DATE
                    ,UPD_USER
                    ,UPD_DATE
                FROM
                    TB_EMPLOYEE
                WHERE 1=1
                    <if test='searchDeptCode != null and searchDeptCode != ""'>
                        AND DEPT_CODE = #{searchDeptCode}
                    </if>
                    <if test='searchStatus != null and searchStatus != ""'>
                        AND STATUS = #{searchStatus}
                    </if>
                    <if test='searchKeyword != null and searchKeyword != ""'>
                        <choose>
                            <when test='searchCondition == "empNo"'>
                                AND EMP_NO LIKE '%'||#{searchKeyword}||'%'
                            </when>
                            <when test='searchCondition == "empName"'>
                                AND EMP_NAME LIKE '%'||#{searchKeyword}||'%'
                            </when>
                            <when test='searchCondition == "email"'>
                                AND EMAIL LIKE '%'||#{searchKeyword}||'%'
                            </when>
                            <otherwise>
                                AND (EMP_NO LIKE '%'||#{searchKeyword}||'%' OR EMP_NAME LIKE '%'||#{searchKeyword}||'%')
                            </otherwise>
                        </choose>
                    </if>
                    <if test='startDt != null and startDt != ""'>
                        AND HIRE_DATE &gt;= TO_DATE(#{startDt}, 'YYYY-MM-DD')
                    </if>
                    <if test='endDt != null and endDt != ""'>
                        AND HIRE_DATE &lt;= TO_DATE(#{endDt}, 'YYYY-MM-DD')
                    </if>
            ) TB
        ) TB_ALL
        <if test="recordCountPerPage > 0">
            WHERE RN BETWEEN #{firstIndex} AND #{firstIndex} + #{recordCountPerPage} - 1
        </if>
    </select>

    <!-- 직원 총 개수 -->
    <select id="selectEmployeeTotalCnt" parameterType="biz.lms.emp.vo.EmployeeVO" resultType="int">
        /* EmployeeDAO.selectEmployeeTotalCnt */
        SELECT COUNT(*) AS CNT
        FROM TB_EMPLOYEE
        WHERE 1=1
            <if test='searchDeptCode != null and searchDeptCode != ""'>
                AND DEPT_CODE = #{searchDeptCode}
            </if>
            <if test='searchStatus != null and searchStatus != ""'>
                AND STATUS = #{searchStatus}
            </if>
            <if test='searchKeyword != null and searchKeyword != ""'>
                <choose>
                    <when test='searchCondition == "empNo"'>
                        AND EMP_NO LIKE '%'||#{searchKeyword}||'%'
                    </when>
                    <when test='searchCondition == "empName"'>
                        AND EMP_NAME LIKE '%'||#{searchKeyword}||'%'
                    </when>
                    <when test='searchCondition == "email"'>
                        AND EMAIL LIKE '%'||#{searchKeyword}||'%'
                    </when>
                    <otherwise>
                        AND (EMP_NO LIKE '%'||#{searchKeyword}||'%' OR EMP_NAME LIKE '%'||#{searchKeyword}||'%')
                    </otherwise>
                </choose>
            </if>
            <if test='startDt != null and startDt != ""'>
                AND HIRE_DATE &gt;= TO_DATE(#{startDt}, 'YYYY-MM-DD')
            </if>
            <if test='endDt != null and endDt != ""'>
                AND HIRE_DATE &lt;= TO_DATE(#{endDt}, 'YYYY-MM-DD')
            </if>
    </select>

    <!-- 직원 상세 조회 -->
    <select id="selectEmployeeDetail" parameterType="string" resultType="biz.lms.emp.vo.EmployeeVO">
        /* EmployeeDAO.selectEmployeeDetail */
        SELECT
            EMP_NO
            ,EMP_NAME
            ,EMAIL
            ,PHONE
            ,DEPT_CODE
            ,DEPT_NAME
            ,POSITION
            ,HIRE_DATE
            ,SALARY
            ,STATUS
            ,REG_USER
            ,REG_DATE
            ,UPD_USER
            ,UPD_DATE
        FROM TB_EMPLOYEE
        WHERE EMP_NO = #{empNo}
    </select>

    <!-- 직원 등록 -->
    <insert id="insertEmployee" parameterType="biz.lms.emp.vo.EmployeeVO">
        /* EmployeeDAO.insertEmployee */
        INSERT INTO TB_EMPLOYEE (
            EMP_NO
            ,EMP_NAME
            ,EMAIL
            ,PHONE
            ,DEPT_CODE
            ,DEPT_NAME
            ,POSITION
            ,HIRE_DATE
            ,SALARY
            ,STATUS
            ,REG_USER
            ,REG_DATE
        ) VALUES (
            #{empNo}
            ,#{empName}
            ,#{email}
            ,#{phone}
            ,#{deptCode}
            ,#{deptName}
            ,#{position}
            ,#{hireDate}
            ,#{salary}
            ,COALESCE(#{status}, 'ACTIVE')
            ,#{regUser}
            ,SYSDATE
        )
    </insert>

    <!-- 직원 수정 -->
    <update id="updateEmployee" parameterType="biz.lms.emp.vo.EmployeeVO">
        /* EmployeeDAO.updateEmployee */
        UPDATE TB_EMPLOYEE
        SET
            EMP_NAME = #{empName}
            ,EMAIL = #{email}
            ,PHONE = #{phone}
            ,DEPT_CODE = #{deptCode}
            ,DEPT_NAME = #{deptName}
            ,POSITION = #{position}
            ,HIRE_DATE = #{hireDate}
            ,SALARY = #{salary}
            ,STATUS = #{status}
            ,UPD_USER = #{updUser}
            ,UPD_DATE = SYSDATE
        WHERE EMP_NO = #{empNo}
    </update>

    <!-- 직원 삭제 -->
    <delete id="deleteEmployee" parameterType="string">
        /* EmployeeDAO.deleteEmployee */
        DELETE FROM TB_EMPLOYEE
        WHERE EMP_NO = #{empNo}
    </delete>

</mapper>
